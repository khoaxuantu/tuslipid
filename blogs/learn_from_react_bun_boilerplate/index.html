<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" crossorigin="anonymous" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC"><link href="/logo/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/logo/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/logo/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/logo/site.webmanifest" rel="manifest"><script type="text/javascript">!function(n){if("/"===n.search[1]){var a=n.search.slice(1).split("&").map((function(n){return n.replace(/~and~/g,"&")})).join("?");window.history.replaceState(null,null,n.pathname.slice(0,-1)+a+n.hash)}}(window.location)</script><link href="https://cdnjs.cloudflare.com" rel="preconnect"><link href="https://cdn.jsdelivr.net" rel="preconnect"><script defer src="/static/js/main.6cba0be9.js"></script><link href="/static/css/main.ce584f9e.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="/static/css/925.5cc9aec9.chunk.css" rel="stylesheet" type="text/css"><title>Tuslipid - Trying to re-create React boilerplate in Bun and what I learned from it</title><meta content="Xuan Khoa Tu Nguyen" data-react-helmet="true" name="author"><meta content="summary_large_image" data-react-helmet="true" name="twitter:card"><meta content="Xuan Khoa Tu Nguyen" data-react-helmet="true" name="twitter:creator"><meta content="/seo/blogs-tuslipid.webp" data-react-helmet="true" itemprop="image"><meta content="article" data-react-helmet="true" property="og:type"><meta content="/seo/blogs-tuslipid.webp" data-react-helmet="true" property="og:image"><meta content="Tusss Blogs" data-react-helmet="true" property="og:site_name"><meta content="/seo/blogs-tuslipid.webp" data-react-helmet="true" name="twitter:image"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://xuankhoatu.com/blogs/learn_from_react_bun_boilerplate/" rel="canonical" data-react-helmet="true"><meta content="Trying to re-create React boilerplate in Bun and what I learned from it" data-react-helmet="true" name="title"><meta content="Trying to re-create React boilerplate in Bun and what I learned from it" data-react-helmet="true" itemprop="name"><meta content="Many people are hyped with Bun for its performance and new features compared with
            NodeJS. One of them is .jsx and .tsx file support with its internal transpiler, which help creating a React
            app by Bun becomes more convenient. But the problem here is to have a boilerplate to optimize the feature
            for creating React app." data-react-helmet="true" name="description"><meta content="Trying to re-create React boilerplate in Bun and what I learned from it | Tusss blogs" data-react-helmet="true" property="og:title"><meta content="Many people are hyped with Bun for its performance and new features compared with
            NodeJS. One of them is .jsx and .tsx file support with its internal transpiler, which help creating a React
            app by Bun becomes more convenient. But the problem here is to have a boilerplate to optimize the feature
            for creating React app." data-react-helmet="true" property="og:description"><meta content="https://xuankhoatu.com/blogs/learn_from_react_bun_boilerplate/" data-react-helmet="true" property="og:url"><meta content="Many people are hyped with Bun for its performance and new features compared with
            NodeJS. One of them is .jsx and .tsx file support with its internal transpiler, which help creating a React
            app by Bun becomes more convenient. But the problem here is to have a boilerplate to optimize the feature
            for creating React app." data-react-helmet="true" name="twitter:description"><meta content="Trying to re-create React boilerplate in Bun and what I learned from it | Tusss blogs" data-react-helmet="true" name="twitter:title"><meta content="https://xuankhoatu.com/blogs/learn_from_react_bun_boilerplate/" data-react-helmet="true" name="twitter:url"></head><body><div id="root"><nav class="navbar navbar-wrap"><button aria-label="navbar" class="navbar-trigger" type="button"></button><ul class="navbar-menu navbar-txt menu-animation"><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/blogs">Blogs</a></li><li><a href="/guestbook">Guestbook</a></li><li><a href="/contact">Contact</a></li><li><a href="/projects">Projects</a></li></ul></nav><div class="container page-wrapper"><div class="header-grp"><div class="header-txt-blog"><b>Trying to re-create React boilerplate in Bun and what I learned from it</b></div></div><hr><article class="single-blog-wrapper transition-blog" style="height:auto"><h1 id="introduction">Introduction</h1><blockquote><p>Many people are hyped with Bun for its performance and new features compared with Node. One of them is .jsx and .tsx file support with its internal transpiler, which help creating a React app by Bun becomes more convenient. But the problem here is to have a boilerplate to optimize the feature for creating React app.</p></blockquote><p>I came up with that idea when reading the <code>JSX</code> runtime of Bun. If we can exclude the works of Babel and Webpack, then we can reduce our build time and bundle's size dramatically.</p><p>I also know that there has already been some templates to create a React app in Bun, such as:</p><pre><code class="hljs language-bash">bun create react-app appname
</code></pre><p>But the template like above simply uses Bun to run <code>npx create-react-app</code> and install all the preset dependencies. It means the project will keep using Babel and Webpack; that's not what I want üôÅ</p><p>Then one day, I find out the appropriate templates in the <code>create-templates</code> repository of the Bun community (you can check them out via this <a href="https://github.com/bun-community/create-templates">link</a>), which are <code>react-ssr</code> and <code>react</code>. Looking at the templates' code, it turned out that I barely understood what each line actually does. I was desperate to discover the true techniques behind them so that came up with an idea is to create a new custom React app boilerplate with Bun. To simulate each technique then I would be able to understand them.</p><blockquote><p>Thus, why not to try?</p></blockquote><p>Below, I will share what I have learned and recalled from my custom boilerplate.</p><p><br><br></p><h1 id="table-of-contents">Table of Contents</h1><ul><li>How are static contents served in a web</li><li>How the server-side rendering delivers React components</li><li>Inside the FileSystemRoute, refers to NextJS's routing</li><li>About client-side rendering</li><li>Cusom the console.log, manually custom a welcome console log</li></ul><p><br><br></p><h1 id="how-are-the-static-contents-served-in-a-web">How are the static contents served in a web</h1><p>The basics comes first, or, as it should be said, everything is built on top of the basics. Sometimes, we are just too focused on fancy stuff that we forget why there are the things called fundamentals. This time, it hit me hard.</p><p>I found the following code in the <a href="https://github.com/bun-community/create-templates/blob/main/react-ssr/dev.tsx"><code>react-ssr</code></a> template:</p><pre><code class="hljs language-ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">serveFromDir</span>(<span class="hljs-params">config: {
  directory: <span class="hljs-built_in">string</span>;
  path: <span class="hljs-built_in">string</span>;
}</span>): <span class="hljs-title class_">Response</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">let</span> basePath = path.<span class="hljs-title function_">join</span>(config.<span class="hljs-property">directory</span>, config.<span class="hljs-property">path</span>);
  <span class="hljs-keyword">const</span> suffixes = [<span class="hljs-string">''</span>, <span class="hljs-string">'.html'</span>, <span class="hljs-string">'index.html'</span>];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> suffix <span class="hljs-keyword">of</span> suffixes) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> pathWithSuffix = path.<span class="hljs-title function_">join</span>(basePath, suffix);
      <span class="hljs-keyword">const</span> stat = <span class="hljs-title function_">statSync</span>(pathWithSuffix);
      <span class="hljs-keyword">if</span> (stat && stat.<span class="hljs-title function_">isFile</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(pathWithSuffix));
      }
    } <span class="hljs-keyword">catch</span> (err) {}
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">request</span>) {
	...
	<span class="hljs-keyword">let</span> reqPath = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>).<span class="hljs-property">pathname</span>;
	...
	<span class="hljs-comment">// check public</span>
    <span class="hljs-keyword">const</span> publicResponse = <span class="hljs-title function_">serveFromDir</span>({
      <span class="hljs-attr">directory</span>: <span class="hljs-variable constant_">PUBLIC_DIR</span>,
      <span class="hljs-attr">path</span>: reqPath,
    });
    <span class="hljs-keyword">if</span> (publicResponse) <span class="hljs-keyword">return</span> publicResponse;
    ...
  }
} satisfies <span class="hljs-title class_">ServeOptions</span>;
</code></pre><p>Like a habit, my head came up with the <code>WTF</code>, that thing was frightening me. Although it looks familiar, somehow I could not understand it at first.</p><blockquote><p>So... I must put myself through what frightening me huh...</p></blockquote><p>It took a long time for me just to regain calm and read the code line by line, and finally, I could break the code into the following pseudocode:</p><pre><code>Define function serveFromDir(directory, filepath):
	basepath -> join directory and file path together
	suffixes -> ['', '.html', 'index.html'] as list

	For each suffix in the suffixes list:
		Try do:
			pathWithSuffix -> join basePath and suffix together
			stat -> get pathWithSuffix's statistic

			If stat exists and stat is a file:
				Return a Response with the blob object of the file located in pathWithSuffix
			End if
		Catch any error
		End try
	End for

	Return null
End define

In Bun serve option
	In async fetch():
		reqPath -> URL's pathname of request.url

		publicResponse -> serveFromDir(PUBLIC_DIR, reqPath)
		If publicResponse exists (not null):
			Return publicResponse as Response
		end if
	end fetch()
end Bun serve otion
</code></pre><p>Typically, the <code>serveFromDir()</code> method resolves the directory and filepath, then checks the statistic in the resolved path. If it knows the statistic exists and there is a file as the resolved path, it will return a <code>Response</code> object containing the file.</p><p>In the Bun serve option, we use the <code>serveFromDir()</code> to map the request pathname to the specific public folder. Thus, if we request to get public content, for example, at <code>http://localhost:3000/image.jpg</code>, the flow will go like this:</p><ol><li>The <code>reqPath</code> is assigned to <code>/image.jpg</code></li><li>Assume we set the <code>PUBLIC_DIR</code> to <code>__dirname + /public</code></li><li>In the <code>serveFromDir()</code>, we will have the <code>basePath</code> which is equivalent to <code>__dirname + /public/image.jpg</code>.</li><li>In the suffix <code>''</code>, we set the <code>pathWithSuffix</code> to the same with <code>basePath</code>, so the code will check the <code>image.jpg</code> in the <code>public</code> folder.</li><li>Assuming there is an <code>image.jpg</code> file in the <code>public</code> folder, it will return a <code>Response</code> object containing the blob object of that file.</li><li>Finally, this <code>Response</code> object is sent to the client browser.</li></ol><p>Recall when we wrote our <code>index.html</code> for the first time, It turns out that everything follows the same concept:</p><ul><li>We request to the server for content.</li><li>The server resolves the request path, then checks the file system.</li><li>The server returns status <code>200</code> if it finds out the content, or status <code>404</code> if the content is not found.</li></ul><p>We can try to start a http server via the popular <a href="https://www.npmjs.com/package/http-server">http-server</a> command in any static content folder, we will get the whole file system displayed on the browser.</p><p>The difference here is just in the Bun serve option; we have specified a specific directory for the app to look into, not only a root directory.</p><blockquote><p>That's why I find the code so familiar huh...</p></blockquote><blockquote><p>... Updating</p></blockquote><p><br><br></p></article><div class="page-copyright pb-3"><div><a href="https://github.com/khoaxuantu/tuslipid" rel="noreferrer" target="_blank" aria-label="web source code"><svg color="black" fill="currentColor" height="1em" opacity="0.8" stroke="currentColor" stroke-width="0" style="color:#000" viewBox="0 0 16 16" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a></div>Built and designed by Xuan Khoa Tu Nguyen with <a href="https://react.dev/" rel="noreferrer" target="_blank">React</a>, <a href="https://www.typescriptlang.org/" rel="noreferrer" target="_blank">TypeScript</a> and <a href="https://sass-lang.com/" rel="noreferrer" target="_blank">Sass</a>.<br>Copyright ¬© 2023 All Rights Reserved.</div></div></div></body></html>