"use strict";(self.webpackChunktuslipid=self.webpackChunktuslipid||[]).push([[679],{2679:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(5677),a=n(184);function s(){return(0,a.jsxs)("div",{className:"header-grp",children:[(0,a.jsx)("div",{className:"header-txt",children:(0,a.jsx)("b",{children:"Guestbook"})}),(0,a.jsxs)("div",{className:"description-txt mt-2",children:["This idea is inspired by "," ",(0,a.jsx)("a",{href:"https://leerob.io/",target:"_blank",rel:"noreferrer",children:"Lee Robinson's portfolio"})," ",":",")"]}),(0,a.jsx)("hr",{})]})}var o=n(9734),c=n(4165),u=n(5861),i=n(9439),l=n(2791),p=n(1413),m=n(4695),h=n(7689),f=n(6531),g=n(5872),d="https://api.xuankhoatu.com",x="f8b754d5fc61f147c9e7";function v(){var e=(0,h.s0)(),t=(0,g.Nq)({onSuccess:function(){var t=(0,u.Z)((0,c.Z)().mark((function t(n){var r;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.code,null!==localStorage.getItem("accessToken")){t.next=4;break}return t.next=4,fetch("".concat(d,"/oauth/google/access_token?code=")+r,{method:"GET"}).then((function(e){return e.json()})).then((function(t){if(t.access_token)return localStorage.setItem("accessToken",t.access_token),localStorage.setItem("third-party","google"),e("/guestbook")}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),flow:"auth-code"}),n=[function(){window.location.assign("https://github.com/login/oauth/authorize?client_id="+x)},function(){return t()}];return(0,a.jsx)(a.Fragment,{children:f.mh.map((function(e,t){return(0,a.jsx)("div",{className:"col-6 btn-oauth-box",children:(0,a.jsx)(m.TX,(0,p.Z)({onClick:n[t]},e))},e.name)}))})}function b(){var e=(0,h.s0)();return(0,a.jsx)("button",{className:"btn btn-rect",onClick:function(){return localStorage.removeItem("third-party"),localStorage.removeItem("data"),e("/guestbook")},children:"Sign out"})}var k=n(1243),j="https://api.xuankhoatu.com";var y=function(){var e=(0,l.useState)(""),t=(0,i.Z)(e,2),n=t[0],r=t[1],s=null;function o(e){return p.apply(this,arguments)}function p(){return(p=(0,u.Z)((0,c.Z)().mark((function e(t){var n,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("get ".concat(t," user")),e.next=3,fetch("".concat(j,"/oauth/").concat(t,"/user"),{method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")}});case 3:return n=e.sent,e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}null!==localStorage.getItem("data")&&(s=JSON.parse(localStorage.getItem("data")).name);var m,h=function(){var e=(0,u.Z)((0,c.Z)().mark((function e(){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("github");case 2:t=e.sent,localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:t.login})),r(t.login);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=(0,u.Z)((0,c.Z)().mark((function e(){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("google");case 2:t=e.sent,localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:t.name})),r(t.name);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function g(){return(g=(0,u.Z)((0,c.Z)().mark((function e(t){var n,r,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(localStorage.getItem("data")),0!==(r=document.getElementById("your-message")).value.length){e.next=6;break}return alert("Your message cannot be empty"),t.preventDefault(),e.abrupt("return");case 6:if(!(r.value.length>512)){e.next=10;break}return alert("Too long! Won't read -_-"),t.preventDefault(),e.abrupt("return");case 10:return a={name:n.name,message:r.value},e.next=13,k.Z.post("".concat(j,"/guestbook/add/"),JSON.stringify(a),{headers:{"Content-Type":"application/json"}});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,l.useEffect)((function(){null===localStorage.getItem("data")&&("github"===localStorage.getItem("third-party")?h():"google"===localStorage.getItem("third-party")&&f())}),[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"mb-2",children:["Sign in as "," ",(0,a.jsx)("b",{children:null!==s?s:n})," "," ","via ",(0,a.jsx)("b",{children:(m=localStorage.getItem("third-party"),m.charAt(0).toUpperCase()+m.slice(1))})]}),(0,a.jsxs)("form",{className:"mb-3 guestbook-form row",onSubmit:function(e){return g.apply(this,arguments)},children:[(0,a.jsx)("input",{className:"col-10 ps-3 pt-3 pb-3 pe-5",placeholder:"Your message...",autoComplete:"off",type:"text",name:"your message","aria-label":"your message",id:"your-message"}),(0,a.jsx)("button",{className:"col-2 p-2",type:"submit",children:(0,a.jsx)("b",{children:"Sign"})})]})]})},S=n(3433);var Z=function(e){var t=e.maxGuests,n=(0,l.useState)(0),r=(0,i.Z)(n,2),s=r[0],o=r[1],p=(0,l.useState)(!0),m=(0,i.Z)(p,2),h=m[0],f=m[1],g=(0,l.useState)([]),d=(0,i.Z)(g,2),x=d[0],v=d[1];(0,l.useEffect)((function(){var e=function(){var e=(0,u.Z)((0,c.Z)().mark((function e(n){var r,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n+40>=t&&f(!h),e.next=4,fetch("".concat("https://api.xuankhoatu.com","/guestbook/list/").concat(n));case 4:return r=e.sent,e.next=7,r.json();case 7:a=e.sent,v([].concat((0,S.Z)(x),(0,S.Z)(a)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();h&&e(s)}),[s]),(0,l.useEffect)((function(){function e(){var e=document.documentElement.scrollTop,t=document.documentElement.scrollHeight;e+document.documentElement.clientHeight>=t&&h&&o((function(e){return e+40}))}return window.addEventListener("scroll",e),function(){return window.removeEventListener("scroll",e)}}),[x]);var b=document.getElementsByClassName("guestbook-txt")[0],k=document.getElementsByClassName("guestbook-wrapper")[0];return(0,l.useEffect)((function(){0!==k.childNodes.length&&(k.style.height="auto")}),[b]),(0,a.jsx)(a.Fragment,{children:x.map((function(e,t){return(0,a.jsxs)("p",{className:"mb-3",children:[(0,a.jsxs)("b",{children:[e.guest.name,":"]})," ",e.guest.message]},t)}))})};var w=function(){var e=(0,l.useState)(0),t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,l.useEffect)((function(){var e=function(){var e=(0,u.Z)((0,c.Z)().mark((function e(){var t,n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("https://api.xuankhoatu.com","/guestbook/totalRecords"));case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,r(n[0].count);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,a.jsxs)("div",{className:"guestbook-wrapper mb-5",children:[(0,a.jsx)(g.rg,{clientId:"555552270687-4u41kl6mdu6va0kp5pn52dma3te6kfk8.apps.googleusercontent.com",children:(0,a.jsx)("div",{className:"btn-grp oauth-grp pb-4",children:null===localStorage.getItem("third-party")?(0,a.jsx)(v,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y,{}),(0,a.jsx)(b,{})]})})}),(0,a.jsx)("hr",{}),(0,a.jsx)("article",{className:"mt-5 guestbook-txt",children:n>0?(0,a.jsx)(Z,{maxGuests:n}):(0,a.jsx)("p",{children:"Waiting for the first message..."})})]})};function N(){return(0,a.jsxs)(r.E.div,{transition:{duration:.8},exit:{opacity:0},className:"container page-wrapper transition-page",children:[(0,a.jsx)(s,{}),(0,a.jsx)(w,{}),(0,a.jsx)(o.Z,{copyright_class:"page-copyright pb-3"})]})}}}]);
//# sourceMappingURL=679.6ad46d04.chunk.js.map