"use strict";(self.webpackChunktuslipid=self.webpackChunktuslipid||[]).push([[719],{2719:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var n=o(184);function s(){return(0,n.jsxs)("div",{className:"header-grp",children:[(0,n.jsx)("div",{className:"header-txt",children:(0,n.jsx)("b",{children:"Guestbook"})}),(0,n.jsxs)("div",{className:"body-txt mt-2",children:["This idea is inspired by "," ",(0,n.jsx)("a",{href:"https://leerob.io/",target:"_blank",rel:"noreferrer",children:"Lee Robinson's portfolio"})," ",":",")"]}),(0,n.jsx)("hr",{})]})}var c=o(9734),a=o(2791),r=o(4695),l=o(7689),i=o(6531);const u=(0,a.createContext)(null);function d(e){let{clientId:t,nonce:o,onScriptLoadSuccess:n,onScriptLoadError:s,children:c}=e;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{nonce:t,onScriptLoadSuccess:o,onScriptLoadError:n}=e,[s,c]=(0,a.useState)(!1),r=(0,a.useRef)(o);r.current=o;const l=(0,a.useRef)(n);return l.current=n,(0,a.useEffect)((()=>{const e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=t,e.onload=()=>{var e;c(!0),null===(e=r.current)||void 0===e||e.call(r)},e.onerror=()=>{var e;c(!1),null===(e=l.current)||void 0===e||e.call(l)},document.body.appendChild(e),()=>{document.body.removeChild(e)}}),[t]),s}({nonce:o,onScriptLoadSuccess:n,onScriptLoadError:s}),l=(0,a.useMemo)((()=>({clientId:t,scriptLoadedSuccessfully:r})),[t,r]);return a.createElement(u.Provider,{value:l},c)}function m(){const e=(0,a.useContext)(u);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}const{REACT_APP_BACKEND_DOMAIN:g,REACT_APP_GITHUB_CLIENT_ID:h}={REACT_APP_BACKEND_DOMAIN:"https://api.xuankhoatu.com",REACT_APP_GITHUB_CLIENT_ID:"f8b754d5fc61f147c9e7"};function p(){let e=(0,l.s0)();const t=function(e){let{flow:t="implicit",scope:o="",onSuccess:n,onError:s,onNonOAuthError:c,overrideScope:r,state:l,...i}=e;const{clientId:u,scriptLoadedSuccessfully:d}=m(),g=(0,a.useRef)(),h=(0,a.useRef)(n);h.current=n;const p=(0,a.useRef)(s);p.current=s;const f=(0,a.useRef)(c);f.current=c,(0,a.useEffect)((()=>{var e;if(!d)return;const n="implicit"===t?"initTokenClient":"initCodeClient",s=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.accounts.oauth2[n]({client_id:u,scope:r?o:"openid profile email ".concat(o),callback:e=>{var t,o;if(e.error)return null===(t=p.current)||void 0===t?void 0:t.call(p,e);null===(o=h.current)||void 0===o||o.call(h,e)},error_callback:e=>{var t;null===(t=f.current)||void 0===t||t.call(f,e)},state:l,...i});g.current=s}),[u,d,t,o,l]);const b=(0,a.useCallback)((e=>{var t;return null===(t=g.current)||void 0===t?void 0:t.requestAccessToken(e)}),[]),v=(0,a.useCallback)((()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.requestCode()}),[]);return"implicit"===t?b:v}({onSuccess:async t=>{let{code:o}=t;null===localStorage.getItem("accessToken")&&await fetch("".concat(g,"/oauth/google/access_token?code=")+o,{method:"GET"}).then((e=>e.json())).then((t=>{if(t.access_token)return localStorage.setItem("accessToken",t.access_token),localStorage.setItem("third-party","google"),e("/guestbook")}))},flow:"auth-code"}),o=[function(){window.location.assign("https://github.com/login/oauth/authorize?client_id="+h)},()=>t()];return(0,n.jsx)(n.Fragment,{children:i.mh.map(((e,t)=>(0,n.jsx)("div",{className:"col-6 btn-oauth-box",children:(0,n.jsx)(r.TX,{onClick:o[t],...e})},e.name)))})}function f(){let e=(0,l.s0)();return(0,n.jsx)("button",{className:"btn btn-rect",onClick:function(){return localStorage.removeItem("third-party"),localStorage.removeItem("data"),e("/guestbook")},children:"Sign out"})}const{REACT_APP_BACKEND_DOMAIN:b}={REACT_APP_BACKEND_DOMAIN:"https://api.xuankhoatu.com"};const v=function(){const[e,t]=(0,a.useState)("");let o=null;async function s(e){console.log("get ".concat(e," user"));const t=await fetch("".concat(b,"/oauth/").concat(e,"/user"),{method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")}});return await t.json()}return null!==localStorage.getItem("data")&&(o=JSON.parse(localStorage.getItem("data")).name),(0,a.useEffect)((()=>{null===localStorage.getItem("data")&&("github"===localStorage.getItem("third-party")?(async()=>{const e=await s("github");localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:e.login})),t(e.login)})():"google"===localStorage.getItem("third-party")&&(async()=>{const e=await s("google");localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:e.name})),t(e.name)})())}),[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"mb-2",children:["Sign in as "," ",(0,n.jsx)("b",{children:null!==o?o:e})," "," ","via ",(0,n.jsx)("b",{children:(c=localStorage.getItem("third-party"),c.charAt(0).toUpperCase()+c.slice(1))})]}),(0,n.jsxs)("form",{className:"mb-3 guestbook-form row",onSubmit:async function(e){e.preventDefault();const t=JSON.parse(localStorage.getItem("data")),o=document.getElementById("your-message");if(0===o.value.length)return void alert("Your message cannot be empty");if(o.value.length>512)return void alert("Too long! Won't read -_-");const n={name:t.name,message:o.value};await fetch("".concat(b,"/guestbook/add/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),mode:"cors"}),alert("Sign successfully :3"),window.location.reload()},children:[(0,n.jsx)("input",{className:"col-10 ps-3 pt-3 pb-3 pe-5",placeholder:"Your message...",autoComplete:"off",type:"text",name:"your message","aria-label":"your message",id:"your-message"}),(0,n.jsx)("button",{className:"col-2 p-2",type:"submit",children:(0,n.jsx)("b",{children:"Sign"})})]})]});var c};const x=function(e){let{maxGuests:t}=e;const[o,s]=(0,a.useState)(0),[c,r]=(0,a.useState)(!0),[l,i]=(0,a.useState)([]);(0,a.useEffect)((()=>{const e=new AbortController,n=e.signal;return c&&(async e=>{e+40>=t&&r(!c);try{const t=await fetch("".concat("https://api.xuankhoatu.com","/guestbook/list/").concat(e),{signal:n}),o=await t.json();i([...l,...o])}catch(o){console.log(o)}})(o),()=>{e.abort()}}),[o]),(0,a.useEffect)((()=>{function e(){const e=document.documentElement.scrollTop,t=document.documentElement.scrollHeight;e+document.documentElement.clientHeight>=t-100&&c&&s((e=>e+40))}return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[l]);const u=document.getElementsByClassName("guestbook-txt")[0],d=document.getElementsByClassName("guestbook-wrapper")[0];return(0,a.useEffect)((()=>{0!==d.childNodes.length&&(d.style.height="auto")}),[u]),(0,n.jsx)(n.Fragment,{children:l.map(((e,t)=>(0,n.jsxs)("p",{className:"mb-3",children:[(0,n.jsxs)("b",{children:[e.guest.name,":"]})," ",e.guest.message]},t)))})};const S=function(){const[e,t]=(0,a.useState)(0);return(0,a.useEffect)((()=>{const e=new AbortController,o=e.signal;return(async()=>{try{const e=await fetch("".concat("https://api.xuankhoatu.com","/guestbook/totalRecords"),{signal:o}),n=await e.json();t(n[0].count)}catch(e){console.log(e)}})(),()=>{e.abort()}}),[]),(0,n.jsxs)("div",{className:"guestbook-wrapper mb-5",children:[(0,n.jsx)(d,{clientId:"555552270687-4u41kl6mdu6va0kp5pn52dma3te6kfk8.apps.googleusercontent.com",children:(0,n.jsx)("div",{className:"btn-grp oauth-grp pb-4",children:null===localStorage.getItem("third-party")?(0,n.jsx)(p,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v,{}),(0,n.jsx)(f,{})]})})}),(0,n.jsx)("hr",{}),(0,n.jsx)("article",{className:"mt-5 guestbook-txt",children:e>0?(0,n.jsx)(x,{maxGuests:e}):(0,n.jsx)("p",{children:"Waiting for the first message..."})})]})};var y=o(3267),j=o(5952);const k="Welcome to my guestbook ~ Leave a message to me here";function w(){const e=(0,y.y)((0,l.TH)()),t={title:"Guestbook",description:k,canonicalURL:e,og:{url:e,description:k},twitter:{url:e,description:k}};return(0,n.jsxs)("div",{className:"container page-wrapper transition-page",children:[(0,n.jsx)(j.Z,{metadata:t}),(0,n.jsx)(s,{}),(0,n.jsx)(S,{}),(0,n.jsx)(c.Z,{copyright_class:"page-copyright pb-3"})]})}}}]);
//# sourceMappingURL=719.90123a62.chunk.js.map