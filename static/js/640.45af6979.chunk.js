/*! For license information please see 640.45af6979.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunktuslipid=self.webpackChunktuslipid||[]).push([[640],{9640:function(t,e,r){r.r(e),r.d(e,{default:function(){return N}});var n=r(184);function o(){return(0,n.jsxs)("div",{className:"header-grp",children:[(0,n.jsx)("div",{className:"header-txt",children:(0,n.jsx)("b",{children:"Guestbook"})}),(0,n.jsxs)("div",{className:"description-txt mt-2",children:["This idea is inspired by "," ",(0,n.jsx)("a",{href:"https://leerob.io/",target:"_blank",rel:"noreferrer",children:"Lee Robinson's portfolio"})," ",":",")"]}),(0,n.jsx)("hr",{})]})}var a=r(9734),c=r(4165),i=r(5861),u=r(9439),s=r(2791),l=r(1413),f=r(4695),h=r(7689),d=r(6531);function p(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}var v=["flow","scope","onSuccess","onError","onNonOAuthError","overrideScope","state"];var m=(0,s.createContext)(null);function g(t){var e=t.clientId,r=t.nonce,n=t.onScriptLoadSuccess,o=t.onScriptLoadError,a=t.children,c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.nonce,r=t.onScriptLoadSuccess,n=t.onScriptLoadError,o=(0,s.useState)(!1),a=(0,u.Z)(o,2),c=a[0],i=a[1],l=(0,s.useRef)(r);l.current=r;var f=(0,s.useRef)(n);return f.current=n,(0,s.useEffect)((function(){var t=document.createElement("script");return t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.nonce=e,t.onload=function(){var t;i(!0),null===(t=l.current)||void 0===t||t.call(l)},t.onerror=function(){var t;i(!1),null===(t=f.current)||void 0===t||t.call(f)},document.body.appendChild(t),function(){document.body.removeChild(t)}}),[e]),c}({nonce:r,onScriptLoadSuccess:n,onScriptLoadError:o}),i=(0,s.useMemo)((function(){return{clientId:e,scriptLoadedSuccessfully:c}}),[e,c]);return s.createElement(m.Provider,{value:i},a)}function y(){var t=(0,s.useContext)(m);if(!t)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return t}var x="https://api.xuankhoatu.com",b="f8b754d5fc61f147c9e7";function w(){var t=(0,h.s0)(),e=function(t){var e=t.flow,r=void 0===e?"implicit":e,n=t.scope,o=void 0===n?"":n,a=t.onSuccess,c=t.onError,i=t.onNonOAuthError,u=t.overrideScope,f=t.state,h=p(t,v),d=y(),m=d.clientId,g=d.scriptLoadedSuccessfully,x=(0,s.useRef)(),b=(0,s.useRef)(a);b.current=a;var w=(0,s.useRef)(c);w.current=c;var k=(0,s.useRef)(i);k.current=i,(0,s.useEffect)((function(){var t;if(g){var e="implicit"===r?"initTokenClient":"initCodeClient",n=null===(t=null===window||void 0===window?void 0:window.google)||void 0===t?void 0:t.accounts.oauth2[e]((0,l.Z)({client_id:m,scope:u?o:"openid profile email ".concat(o),callback:function(t){var e,r;if(t.error)return null===(e=w.current)||void 0===e?void 0:e.call(w,t);null===(r=b.current)||void 0===r||r.call(b,t)},error_callback:function(t){var e;null===(e=k.current)||void 0===e||e.call(k,t)},state:f},h));x.current=n}}),[m,g,r,o,f]);var S=(0,s.useCallback)((function(t){var e;return null===(e=x.current)||void 0===e?void 0:e.requestAccessToken(t)}),[]),j=(0,s.useCallback)((function(){var t;return null===(t=x.current)||void 0===t?void 0:t.requestCode()}),[]);return"implicit"===r?S:j}({onSuccess:function(){var e=(0,i.Z)((0,c.Z)().mark((function e(r){var n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.code,null!==localStorage.getItem("accessToken")){e.next=4;break}return e.next=4,fetch("".concat(x,"/oauth/google/access_token?code=")+n,{method:"GET"}).then((function(t){return t.json()})).then((function(e){if(e.access_token)return localStorage.setItem("accessToken",e.access_token),localStorage.setItem("third-party","google"),t("/guestbook")}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),flow:"auth-code"}),r=[function(){window.location.assign("https://github.com/login/oauth/authorize?client_id="+b)},function(){return e()}];return(0,n.jsx)(n.Fragment,{children:d.mh.map((function(t,e){return(0,n.jsx)("div",{className:"col-6 btn-oauth-box",children:(0,n.jsx)(f.TX,(0,l.Z)({onClick:r[e]},t))},t.name)}))})}function k(){var t=(0,h.s0)();return(0,n.jsx)("button",{className:"btn btn-rect",onClick:function(){return localStorage.removeItem("third-party"),localStorage.removeItem("data"),t("/guestbook")},children:"Sign out"})}var S="https://api.xuankhoatu.com";var j=function(){var t=(0,s.useState)(""),e=(0,u.Z)(t,2),r=e[0],o=e[1],a=null;function l(t){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)((0,c.Z)().mark((function t(e){var r,n;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("get ".concat(e," user")),t.next=3,fetch("".concat(S,"/oauth/").concat(e,"/user"),{method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")}});case 3:return r=t.sent,t.next=6,r.json();case 6:return n=t.sent,t.abrupt("return",n);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}null!==localStorage.getItem("data")&&(a=JSON.parse(localStorage.getItem("data")).name);var h,d=function(){var t=(0,i.Z)((0,c.Z)().mark((function t(){var e;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l("github");case 2:e=t.sent,localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:e.login})),o(e.login);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){var t=(0,i.Z)((0,c.Z)().mark((function t(){var e;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l("google");case 2:e=t.sent,localStorage.removeItem("accessToken"),localStorage.setItem("data",JSON.stringify({name:e.name})),o(e.name);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function v(){return(v=(0,i.Z)((0,c.Z)().mark((function t(e){var r,n,o;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),r=JSON.parse(localStorage.getItem("data")),0!==(n=document.getElementById("your-message")).value.length){t.next=6;break}return alert("Your message cannot be empty"),t.abrupt("return");case 6:if(!(n.value.length>512)){t.next=9;break}return alert("Too long! Won't read -_-"),t.abrupt("return");case 9:return o={name:r.name,message:n.value},t.next=12,fetch("".concat(S,"/guestbook/add/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),mode:"cors"});case 12:alert("Sign successfully :3"),window.location.reload();case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,s.useEffect)((function(){null===localStorage.getItem("data")&&("github"===localStorage.getItem("third-party")?d():"google"===localStorage.getItem("third-party")&&p())}),[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"mb-2",children:["Sign in as "," ",(0,n.jsx)("b",{children:null!==a?a:r})," "," ","via ",(0,n.jsx)("b",{children:(h=localStorage.getItem("third-party"),h.charAt(0).toUpperCase()+h.slice(1))})]}),(0,n.jsxs)("form",{className:"mb-3 guestbook-form row",onSubmit:function(t){return v.apply(this,arguments)},children:[(0,n.jsx)("input",{className:"col-10 ps-3 pt-3 pb-3 pe-5",placeholder:"Your message...",autoComplete:"off",type:"text",name:"your message","aria-label":"your message",id:"your-message"}),(0,n.jsx)("button",{className:"col-2 p-2",type:"submit",children:(0,n.jsx)("b",{children:"Sign"})})]})]})},E=r(3433);var L=function(t){var e=t.maxGuests,r=(0,s.useState)(0),o=(0,u.Z)(r,2),a=o[0],l=o[1],f=(0,s.useState)(!0),h=(0,u.Z)(f,2),d=h[0],p=h[1],v=(0,s.useState)([]),m=(0,u.Z)(v,2),g=m[0],y=m[1];(0,s.useEffect)((function(){var t=new AbortController,r=t.signal,n=function(){var t=(0,i.Z)((0,c.Z)().mark((function t(n){var o,a;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n+40>=e&&p(!d),t.prev=2,t.next=5,fetch("".concat("https://api.xuankhoatu.com","/guestbook/list/").concat(n),{signal:r});case 5:return o=t.sent,t.next=8,o.json();case 8:a=t.sent,y([].concat((0,E.Z)(g),(0,E.Z)(a))),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e){return t.apply(this,arguments)}}();return d&&n(a),function(){t.abort()}}),[a]),(0,s.useEffect)((function(){function t(){var t=document.documentElement.scrollTop,e=document.documentElement.scrollHeight;t+document.documentElement.clientHeight>=e&&d&&l((function(t){return t+40}))}return window.addEventListener("scroll",t),function(){return window.removeEventListener("scroll",t)}}),[g]);var x=document.getElementsByClassName("guestbook-txt")[0],b=document.getElementsByClassName("guestbook-wrapper")[0];return(0,s.useEffect)((function(){0!==b.childNodes.length&&(b.style.height="auto")}),[x]),(0,n.jsx)(n.Fragment,{children:g.map((function(t,e){return(0,n.jsxs)("p",{className:"mb-3",children:[(0,n.jsxs)("b",{children:[t.guest.name,":"]})," ",t.guest.message]},e)}))})};var Z=function(){var t=(0,s.useState)(0),e=(0,u.Z)(t,2),r=e[0],o=e[1];return(0,s.useEffect)((function(){var t=new AbortController,e=t.signal,r=function(){var t=(0,i.Z)((0,c.Z)().mark((function t(){var r,n;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat("https://api.xuankhoatu.com","/guestbook/totalRecords"),{signal:e});case 3:return r=t.sent,t.next=6,r.json();case 6:n=t.sent,o(n[0].count),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}();return r(),function(){t.abort()}}),[]),(0,n.jsxs)("div",{className:"guestbook-wrapper mb-5",children:[(0,n.jsx)(g,{clientId:"555552270687-4u41kl6mdu6va0kp5pn52dma3te6kfk8.apps.googleusercontent.com",children:(0,n.jsx)("div",{className:"btn-grp oauth-grp pb-4",children:null===localStorage.getItem("third-party")?(0,n.jsx)(w,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j,{}),(0,n.jsx)(k,{})]})})}),(0,n.jsx)("hr",{}),(0,n.jsx)("article",{className:"mt-5 guestbook-txt",children:r>0?(0,n.jsx)(L,{maxGuests:r}):(0,n.jsx)("p",{children:"Waiting for the first message..."})})]})};function N(){return(0,n.jsxs)("div",{className:"container page-wrapper transition-page",children:[(0,n.jsx)(o,{}),(0,n.jsx)(Z,{}),(0,n.jsx)(a.Z,{copyright_class:"page-copyright pb-3"})]})}},5861:function(t,e,r){function n(t,e,r,n,o,a,c){try{var i=t[a](c),u=i.value}catch(s){return void r(s)}i.done?e(u):Promise.resolve(u).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,a){var c=t.apply(e,r);function i(t){n(c,o,a,i,u,"next",t)}function u(t){n(c,o,a,i,u,"throw",t)}i(void 0)}))}}r.d(e,{Z:function(){return o}})},4165:function(t,e,r){r.d(e,{Z:function(){return o}});var n=r(1002);function o(){o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},i=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",s=c.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(I){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof p?e:p,c=Object.create(o.prototype),i=new Z(n||[]);return a(c,"_invoke",{value:S(t,r,i)}),c}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(I){return{type:"throw",arg:I}}}t.wrap=f;var d={};function p(){}function v(){}function m(){}var g={};l(g,i,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(N([])));x&&x!==e&&r.call(x,i)&&(g=x);var b=m.prototype=p.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function o(a,c,i,u){var s=h(t[a],t,c);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==(0,n.Z)(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,i,u)}),(function(t){o("throw",t,i,u)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return o("throw",t,i,u)}))}u(s.arg)}var c;a(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return c=c?c.then(n,n):n()}})}function S(t,e,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return O()}for(r.method=o,r.arg=a;;){var c=r.delegate;if(c){var i=j(c,r);if(i){if(i===d)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=h(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function j(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,j(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=h(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,d;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Z(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return v.prototype=m,a(b,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:v,configurable:!0}),v.displayName=l(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(k.prototype),l(k.prototype,u,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var c=new k(f(e,r,n,o),a);return t.isGeneratorFunction(r)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},w(b),l(b,s,"Generator"),l(b,i,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=N,Z.prototype={constructor:Z,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return c.type="throw",c.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var i=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(i&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=t,c.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:N(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},t}}}]);
//# sourceMappingURL=640.45af6979.chunk.js.map